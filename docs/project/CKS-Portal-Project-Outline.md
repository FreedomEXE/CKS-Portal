# CKS Portal – Project Outline

## 1. Project Overview
The **CKS Portal** is a role-based web application designed to centralize operations for contractors, customers, crew members, centers, and managers within the CKS business ecosystem. The portal will replace the existing spreadsheet-based workflow (“CKS Brain”) with a modern, secure, and scalable system.

The system allows for:
- Searching and managing all business entities from an admin dashboard
- Viewing detailed profile pages for each entity
- Role-based logins for different user types
- Ordering of supplies and services
- Access to training and procedural documentation
- Management of work assignments and tracking
# CKS Portal – Project Outline

## 1. Project Overview
The CKS Portal is a role-based web app that centralizes operations for Contractors, Customers, Crew, Centers, Managers, and Admins. It replaces spreadsheet workflows (“CKS Brain”) with a secure, scalable system.

Key capabilities:
- Search and manage entities from an Admin directory (unified single page with tabs)
- View consistent profile pages for each entity
- Clerk-based authentication with username-scoped hubs at `/{id}/hub`
- Ordering of services and supplies (Centers/Managers)
- Access to training and procedural documentation
- Manage assignments and tracking
- Reporting from Centers to Managers/Admins with scoped visibility

Business model highlights:
- Centers request services/supplies; Managers can do so on their behalf.
- Contractors fulfill; Customers pay; CKS orchestrates.
- Username-scoped routing ensures users land on their hub after sign-in and keeps URLs shareable and predictable.
- Provides crew members with training and procedural resources
- Enables reporting from centers to address job quality or operational issues promptly

---

## 3. Tech Stack & Tools

### **Frontend**
- **React + Vite** (TypeScript)
- Simplifies communication and coordination between all roles
- Enables Contractors/Customers to place or review service/supply requests where permitted
- Gives Managers visibility into operations across assigned centers
- Provides Crew with training/procedural resources and assignments
- Enables reporting from Centers to address quality/operational issues promptly
- Keeps a consistent “My Hub” and “My Profile” experience across roles (header widget entry; hidden on Admin routes)

### **Backend**
- **Node.js + Express** (TypeScript)
## 3. Tech Stack & Tools
- **pg** – PostgreSQL client
- **dotenv** – environment configuration
- **CORS** – API cross-origin handling

### **Development Tools**
- **VS Code** – code editing
- **Beekeeper Studio** – database management
- **GitHub** – version control
- **npm** – package management
- **ts-node-dev** – TypeScript hot reloading for backend

### **Hosting / Deployment**
- **Vercel** – frontend hosting
- **Render** – backend hosting + PostgreSQL database

---

## 4. Data Model (Entities)

| Entity       | ID Format  | Description |
|--------------|-----------|-------------|
| **Crew**     | `001-A`   | Individual staff members |
| **Contractor** | `001-B`   | Contracting companies working with CKS |
| **Customer** | `001-C`   | Customers receiving services |
| **Center**   | `001-D`   | Physical service locations |
| **Services** | `001-S`   | Provided services |
| **Supplies** | `001-P`   | Provided products/supplies |
| **Procedures** | `001-PR` | Process & operational guides |
| **Training** | `001-T`   | Training materials |
## 4. Data Model (Entities)
| **Warehouses** | `001-W` | Supply storage facilities |
| **Reports** | `001-R` | Center-generated reports on job quality/issues |

**Relationships:**
- Contractors → Customers → Centers
- Crew assigned to Centers
- Orders linked to Customers or Centers
- Training/Procedures accessible by all roles (with restrictions)
- Reports generated by Centers, visible to Managers/Admins

---

## 5. MVP Scope
**Features to be completed for MVP:**
1. **Authentication & Role-Based Access**
   - Clerk-based login
   - Internal code linking (e.g., `001-B` → Contractor)
   - Role-specific dashboards

2. **Admin Dashboard**
   - Searchable & paginated lists for Crew, Contractors, Customers, Centers
   - Click-to-view entity profile pages
   - “View As” function to impersonate an entity

## 5. MVP Scope
Features targeted for MVP:
1) Authentication & role access
   - Clerk sign-in (CKS ID/password) and Google OAuth; logo visible on homepage
   - Username-scoped hubs after sign-in: `/{id}/hub` (legacy `/hub` normalizes)
   - `/me/bootstrap` linking for `{ role, code }`

2) Admin hub: Unified Directory + core flows
   - One Directory page with 13 tabs (Crew, Contractors, Customers, Centers, Services, Jobs, Supplies, Procedures, Training, Management, Warehouses, plus Orders and Reports split views)
   - Fast search and pagination; consistent tables; entity drill-in
   - Orders and Reports views with status and basic filters

3) Entity profiles
   - Template-based profiles with Summary and Contact sections; consistent tabs
   - “My Profile” entry via header UserWidget (suppressed on Admin routes)

4) Ordering system
   - Centers and Managers can request services/supplies (Manager may act for Center)
   - Basic Admin oversight of order queue

5) Training & Procedures
   - Read access for all roles; categorized resources

6) Reporting (phase-in)
   - Reports originate from Centers; visibility spans Center, its Customer, its Contractor, assigned Manager, serving Crew, and Admins
   - Admin/Manager triage with simple state transitions

7) Responsive, consistent UI
   - Clean, accessible styling with Tailwind
   - Shared UI primitives (Button, Input, Select, Badge, Alert, Card, Table, Tabs, Pagination)
## 7. Deployment Plan
1. **Development** – Local setup in VS Code with live reload (Vite frontend, ts-node-dev backend)
2. **Staging** – Deploy backend to Render and frontend to Vercel using staging DB
## 6. Post-MVP Ideas
- Job scheduling & assignment tracking
- Real-time notifications
- Messaging between roles
- Payments/invoicing and deeper financials
- Advanced analytics & dashboards
- **Mockups:** Ecosystem folder profile examples
- **Backend Repo Structure:**
  - `server/src` → backend code
## 7. Deployment Plan

---

## 9. Current Status (Aug 2025)
- Hubs standardized across roles to a minimal “My Hub” with consistent button order and labels.
- User-scoped pages implemented: `/me/services`, `/me/jobs`, `/me/reports` (backend contract `q={code}`).
## 8. Key References
- Center and Customer hubs include a prominent “New Request” CTA; Center hub omits “My Centers”.
- Support and Documents stub pages added and scoped by user code.
- Dev ergonomics: profile code override via `?code` for impersonation; safe demo fallbacks.

### Today’s Updates (Aug 15, 2025)
- Added a compact User Widget in the header (top-right) that routes to unified My Profile (`/me/profile`). The widget is hidden on Admin routes and the Admin hub.
- Removed redundant “My Profile” buttons from all Hub pages to avoid duplicate entry points.
- Simplified My Profile UX: tabs and table headings only; removed the large profile header card from My Profile views.
## 9. Current Status (Aug 2025)
- Username-scoped routing in place: post-login lands on `/{id}/hub`; `/` and `/home` forward to `/login`.
- Admin Directory consolidated into a single tabbed page (13 tabs). Orders and Reports function as split views in the Directory.
- Header UserWidget is the unified “My Profile” entry point; it is suppressed on Admin routes to reduce duplication.
- News & Updates preview is present; Admin shows an unread indicator and a “View all” link.
- Center and Customer hubs include a prominent “New Request” CTA; Center hub omits “My Centers”.
- Support and Documents stub pages exist and are scoped by user code.
- Dev ergonomics: optional `?code=` query for impersonation/dev; safe fallbacks.
- Confirm manager role derivation and mapping for `MGR-###` codes in `/me/profile` so the unified route selects the correct presenter.
- Provide stubbed endpoints or fixtures for manager-related tabs used in headings to support future data wiring.
- Validate impersonation audit logging and ensure the widget respects derived identity and active code.
## 10. Next Steps

### Frontend
- Continue applying shared UI primitives (Button, Input, Select, Badge, Alert, Card, Table, Tabs, Pagination) across pages for consistency.
- Verify header UserWidget behavior across routes; ensure navigation to `/me/profile` is consistent, with Admin suppression.
- Accessibility: add ARIA roles/labels and keyboard navigation for tabs and the UserWidget.
- Tests: add routing/unit tests for My Profile tabs and the Admin Directory tab bar.
- Improve loading/empty states in Directory tabs (skeletons, “no data yet” messages).

### Backend
- Confirm manager role derivation/mapping for `MGR-###` codes in `/me/profile` and bootstrap.
- Provide minimal fixtures/stub endpoints for manager-related tabs to enable UI wiring.
- Prepare impersonation audit logging endpoints (start/stop) aligned to PRD design notes.

### Docs & Process
- Add/confirm ADR on the Single Profile Entry Point and Admin suppression.
- Keep PRD updated with tab lists and routing notes; include a short “How to impersonate” section in README.

### QA & Release
- Maintain a regression checklist for header widget visibility, Admin exclusion, and Directory navigation.
- Ensure CI runs typecheck and lint on PRs; include a production build step.

### Forms & Scoping (carry-over)
- Build request forms for Service, Job, Supplies, and Products (prefill `q={code}`; simple submit success path).
- Confirm backend scoping for `/admin/{jobs,services,reports}` and `/news` (fixtures/tests).
- Add scope badges/banners on `/me` pages (active code and role).
